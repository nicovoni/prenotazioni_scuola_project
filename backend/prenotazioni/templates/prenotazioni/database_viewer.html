{% extends "base.html" %}

{% block title %}Database Viewer - Sistema di Prenotazioni{% endblock %}

{% block content %}
<div style="padding: 20px; font-family: monospace; background: #f5f5f5;">
    <h1 style="color: #333; border-bottom: 2px solid #333; padding-bottom: 10px;">DATABASE VIEWER</h1>
    <p style="color: #666; font-size: 14px;">Vista diretta del contenuto delle tabelle del database</p>

    {% for table_key, table_info in tables_data.items %}
    <div style="margin: 30px 0; background: white; border: 1px solid #ccc;">
        <h2 style="background: #333; color: white; padding: 10px; margin: 0; font-size: 16px;">
            Tabella: {{ table_info.name }}
        </h2>

        {% if table_info.data %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: #f0f0f0;">
                            {% for field in table_info.fields %}
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left; font-weight: bold;">{{ field }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in table_info.data %}
                        <tr>
                            {% for field in table_info.fields %}
                            <td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">
                                {% if field == 'is_active' %}
                                    {{ record.is_active|yesno:"True,False" }}
                                {% elif field == 'inizio' or field == 'fine' %}
                                    {{ record|getattr:field|date:"Y-m-d H:i:s" }}
                                {% elif field == 'utente__username' %}
                                    {{ record.utente.username }}
                                {% elif field == 'risorsa__nome' %}
                                    {{ record.risorsa.nome }}
                                {% else %}
                                    {{ record|getattr:field|default:"NULL"|truncatechars:50 }}
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div style="padding: 10px; background: #f9f9f9; border-top: 1px solid #ccc; font-size: 12px; color: #666;">
                Totale record: {{ table_info.data|length }}
            </div>
        {% else %}
            <div style="padding: 20px; text-align: center; color: #666;">
                Nessun record presente nella tabella
            </div>
        {% endif %}
    </div>
    {% endfor %}

    <div style="margin-top: 30px; padding: 10px; background: #e8e8e8; border: 1px solid #ccc; text-align: center;">
        <a href="{% url 'lista_prenotazioni' %}" style="color: #333; text-decoration: none;">
            ‚Üê Torna alle Prenotazioni
        </a>
    </div>
</div>
{% endblock %}
