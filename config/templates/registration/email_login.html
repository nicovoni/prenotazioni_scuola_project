{% extends "base.html" %}

{% block title %}Accedi - Sistema di Prenotazioni{% endblock %}

{% block content %}
<div class="content-card">
    <h2 style="text-align: center; color: #2c3e50; margin-bottom: 2rem;">üîê Accedi con la tua email scolastica</h2>

    <div style="max-width: 400px; margin: 0 auto;">
        <form method="post">
            {% csrf_token %}
            <div style="margin-bottom: 1.5rem;">
                <label for="email" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">Email istituzionale:</label>
                <input type="email" name="email" id="email" placeholder="i.cognome@isufol.it"
                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 6px; font-size: 16px; box-sizing: border-box;"
                       required autofocus>
                <div style="font-size: 13px; color: #6c757d; margin-top: 0.5rem; font-style: italic;">
                    Formato: iniziale del nome + punto + cognome. Esempio: i.nizzo@isufol.it
                </div>
            </div>
            <button type="submit" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer;">
                üìß Invia PIN
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function validateEmailForm(event) {
        var email = document.getElementById('email').value.trim();
        var domain = 'isufol.it';
        // iniziale del primo nome, punto, cognome (apostrofo consentito)
        var localRegex = /^[A-Za-z]\.[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø']+[0-9]*$/i;
        if (!email) {
            alert('Inserisci la tua email dell\'istituto.');
            event.preventDefault();
            return false;
        }
        var parts = email.split('@');
        if (parts.length !== 2 || parts[1].toLowerCase() !== domain) {
            alert('Sono accettate solo email del dominio ' + domain + '.');
            event.preventDefault();
            return false;
        }
        if (!localRegex.test(parts[0])) {
            alert("Formato email non valido. Usa l'iniziale del nome (se hai pi√π nomi, usa la prima iniziale), punto e cognome; puoi aggiungere un numero alla fine se necessario (es. i.nizzo@isufol.it o i.nizzo1@isufol.it). ");
            event.preventDefault();
            return false;
        }
        return true;
    }
    document.addEventListener('DOMContentLoaded', function(){
        var form = document.querySelector('form');
        if (form) form.addEventListener('submit', validateEmailForm);
    });
</script>
{% endblock %}
