{% extends "base.html" %}

{% block title %}Prenota Risorsa - Sistema di Prenotazioni{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ðŸ“… Prenota una Risorsa</h1>
    <p class="page-subtitle">Seleziona la risorsa, data e ora per la tua prenotazione</p>
</div>

<div class="content-card">
    <form method="post" style="max-width: 500px; margin: 0 auto;">
        {% csrf_token %}

        <div style="margin-bottom: 1.5rem;">
            <label for="id_risorsa" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">Risorsa:</label>
            {{ form.risorsa }}
            <div id="resource-info" class="resource-info"></div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
            <div>
                <label for="id_data" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">Data:</label>
                {{ form.data }}
            </div>
            <div>
                <label for="id_ora_inizio" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">Ora inizio:</label>
                {{ form.ora_inizio }}
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
            <div>
                <label for="id_ora_fine" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">Ora fine:</label>
                {{ form.ora_fine }}
            </div>
            <div>
                <label for="id_quantita" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">QuantitÃ :</label>
                {{ form.quantita }}
            </div>
        </div>

        <button type="submit" style="width: 100%; padding: 14px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 1rem;">
            âœ… Conferma Prenotazione
        </button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Funzione semplificata per aggiornare il campo quantitÃ 
    function updateQuantityField() {
        const risorsaSelect = document.getElementById('id_risorsa');
        const quantitaInput = document.getElementById('id_quantita');
        const infoDiv = document.getElementById('resource-info');
        const selectedOption = risorsaSelect.options[risorsaSelect.selectedIndex];

        if (selectedOption && selectedOption.value) {
            const tipo = selectedOption.textContent.toLowerCase();

            if (tipo.includes('laboratorio')) {
                // Laboratori: prenotazione fissa dell'intero spazio
                quantitaInput.value = 1;
                quantitaInput.readOnly = true;
                infoDiv.textContent = 'Prenotazione dell\'intero laboratorio (spazio fisso)';
            } else if (tipo.includes('carrello')) {
                // Carrelli: prenotazione parziale possibile
                quantitaInput.readOnly = false;
                // Estrai il numero dal nome (es. "Carrello 25 iPad" -> 25)
                const match = selectedOption.textContent.match(/(\d+)/);
                if (match) {
                    const maxQty = parseInt(match[1]);
                    quantitaInput.max = maxQty;
                    if (parseInt(quantitaInput.value) > maxQty) {
                        quantitaInput.value = maxQty;
                    }
                    infoDiv.textContent = `Prenotazione parziale possibile (max ${maxQty} unitÃ )`;
                }
            }
        } else {
            // Nessuna risorsa selezionata
            quantitaInput.readOnly = false;
            infoDiv.textContent = '';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const risorsaSelect = document.getElementById('id_risorsa');
        if (risorsaSelect) {
            risorsaSelect.addEventListener('change', updateQuantityField);
            // Piccola pausa per assicurarsi che il DOM sia pronto
            setTimeout(updateQuantityField, 100);
        }
    });
</script>
{% endblock %}
